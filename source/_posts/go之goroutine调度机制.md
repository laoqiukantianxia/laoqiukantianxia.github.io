title: go之goroutine调度机制
author: QIU
date: 2018-12-04 09:22:04
tags:
---
**调度器**

**G:** 基本上，进程内的一切都在以goroutine（简称G）方式运行。但是，G并不是执行体，它仅仅保存并发任务状态，为任务执行提供所需栈内存空间。G初始栈非常小，只有2kb（系统级默认MB级别的线程栈），创建操作只是在用户空间简单的分配对象，远比进入内核态分配线程要简单多。

G任务创建后被放置在P本地队列或全局队列，等待工作线程调度执行。

`关键字go并非执行并发操作，而是创建一个并发执行单元`

**P:** Processor（简称P），其作用类似cpu核，用来控制可同时并发执行的任务数量。每个工作线程都必须绑定一个有限的P才被允许执行任务，否则只能休眠，只能有空闲P时被唤醒。

**M:** 实际执行体是系统线程（简称M）。它和P绑定，以调度循环方式不停执行G并发任务。M通过修改寄存器，将执行栈指向G自带的栈内存，并在此空间内分配堆栈帧，执行任务函数

**线程仅负责执行，不在持有状态，这是并发任务跨线程调度，实现多路复用的根本所在**